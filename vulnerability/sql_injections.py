from typing import Any, Tuple

import numpy as np
from scipy.stats import ttest_ind

from utils.requests import get_requests_times


def url_vulnerability(
    url: str, number: int, argument_name: str, argument_value: Any, sleep: int
) -> Tuple[bool, np.array, np.array]:
    """test url vulnerability with Student's t-test"""
    save_times = np.array(get_requests_times(url, number, {argument_name: argument_value}), dtype=np.float)
    inject_times = np.array(get_requests_times(url, number, {argument_name: f"SLEEP({sleep:d})"}), dtype=np.float)

    _, p_value = ttest_ind(save_times, inject_times, nan_policy="omit")

    return p_value <= 0.05, save_times, inject_times
